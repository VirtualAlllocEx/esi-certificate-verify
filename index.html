<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Certificate Verification</title>
<style>
body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; padding: 24px; }
.wrap { max-width: 720px; margin: 0 auto; }
header { margin-bottom: 20px; }
h1 { font-size: 1.6rem; margin: 0 0 0.25rem; }
.muted { color: #666; font-size: .95rem; }
.card { border: 1px solid #ddd; border-radius: 12px; padding: 16px 18px; margin: 14px 0; }
.ok { border-color: #2e7d32; background: #f1f8f2; }
.bad { border-color: #c62828; background: #fdf2f2; }
.row { display: grid; grid-template-columns: 160px 1fr; gap: 12px; padding: 8px 0; border-top: 1px dashed #e3e3e3; }
.row:first-child { border-top: 0; }
code { background: #f6f8fa; padding: 2px 6px; border-radius: 6px; }
.actions { margin-top: 12px; display: flex; gap: 8px; }
button { cursor: pointer; border: 1px solid #ccc; background: #fff; padding: 8px 12px; border-radius: 8px; }
</style>
</head>
<body>
<div class="wrap">
<header>
<h1>Certificate Verification-Endpoint Security Insights Workshop by RedOps GmbH</h1>
<div class="muted">Scan a QR or open a link like <code>/RED-ABCD-EF12-3456</code> or <code>?c=RED-…</code>.</div>
</header>


<div id="panel" class="card">
<p>Looking up the certificate…</p>
</div>


<div id="details" class="card" style="display:none"></div>


<footer class="muted" style="margin-top:24px">
If you believe a result is incorrect, please contact the issuer.
</footer>
</div>


<script>
(function() {
const TITLE = 'Certificate Verification';


function candidateId() {
try {
const url = new URL(window.location.href);
let id = url.searchParams.get('c');
if (!id) {
let p = decodeURIComponent(url.pathname)
.replace(/^\/+|\/+$/g, '') // trim leading/trailing slashes
.replace(/index\.html$/i, '') // ignore index.html
.replace(/verify\.html$/i, '');
if (p) id = p;
}
return (id || '').toUpperCase().trim();
} catch (e) { return ''; }
}


function validFormat(id) {
// Accepts RED-XXXX-XXXX-XXXX (A-Z, 0-9). Relax this if you use another scheme.
return /^RED-[A-Z0-9]{4}-[A-Z0-9]{4}-[A-Z0-9]{4}$/.test(id);
}


function setPanel(html, ok) {
const el = document.getElementById('panel');
el.className = 'card ' + (ok === true ? 'ok' : ok === false ? 'bad' : '');
el.innerHTML = html;
}


function setDetails(rows) {
const el = document.getElementById('details');
if (!rows || !rows.length) { el.style.display = 'none'; return; }
el.style.display = 'block';
el.innerHTML = rows.map(([k,v]) => `<div class="row"><div class="muted">${k}</div><div>${v || '<span class="muted">(not provided)</span>'}</div></div>`).join('');
}


async function main() {
const id = candidateId();
if (!id) {
setPanel('No certificate ID provided. Append <code>?c=RED-XXXX-XXXX-XXXX</code> to the URL or open <code>/RED-XXXX-XXXX-XXXX</code>.');
document.title = TITLE;
return;
}
document.title = `${TITLE} – ${id}`;


if (!validFormat(id)) {
setPanel(`<strong>Invalid ID format.</strong><br/>Got <code>${id}</code>. Expected something like <code>RED-ABCD-1234-EF56</code>.`, false);
return;
}


let db;
try {
const res = await fetch('ids.json', { cache: 'no-store' });
if (!res.ok) throw new Error(res.statusText);
db = await res.json();
} catch (e) {
setPanel('Could not load the verification database (<code>ids.json</code>). Try again or contact the issuer.', false);
return;
}


const rec = db[id];
if (!rec) {
setPanel(`<strong>Not found.</strong> The certificate <code>${id}</code> is not in our list, or may have been revoked.`, false);
return;
}


if (rec.revoked) {
setPanel(`<strong>Revoked.</strong> The certificate <code>${id}</code> was revoked by the issuer.`, false);
setDetails([
['Certificate ID', `<code>${id}</code>`],
['Revoked on', rec.revoked_on || '' ],
['Reason', rec.reason || '' ]
]);
return;
}


setPanel(`<strong>Valid certificate.</strong> ID <code>${id}</code> was issued by the organization.`, true);
setDetails([
['Certificate ID', `<code>${id}</code>`],
['Participant', rec.participant_name || '' ],
['Issue date', rec.issue_date || '' ]
]);


// Small UX: add quick-copy link
const a = document.createElement('div');
a.className = 'actions';
a.innerHTML = `<button id="copy">Copy link</button>`;
document.getElementById('panel').appendChild(a);
document.getElementById('copy').onclick = () => {
navigator.clipboard.writeText(window.location.href).then(()=>{
document.getElementById('copy').innerText = 'Copied!';
setTimeout(()=>document.getElementById('copy').innerText='Copy link', 1500);
});
};
}


main();
})();
</script>
</body>
</html>
