<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Certificate Verification</title>
<link rel="icon" href="assets/redops-logo.png">
<style>
  /* ---------- Theme ---------- */
  :root{
    --brand: #8c2f3b;          /* RedOps burgundy */
    --brand-ink: #5f1f28;
    --ok: #2e7d32;
    --bad: #c62828;
    --surface: #ffffff;
    --muted: #6b7280;
    --border: #e5e7eb;
    --shadow: 0 10px 30px rgba(0,0,0,.06);
    --radius: 14px;
  }
  @media (prefers-color-scheme: dark){
    :root{
      --surface:#121316;
      --muted:#a3a9b1;
      --border:#23262a;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    body{ color:#e9edf2; }
    code{ background:#1a1c20; }
    .input{ background:#0f1013; color:#e9edf2; border-color:#2a2d33; }
    .btn.ghost{ background:#0f1013; border-color:#2a2d33; }
  }

  /* ---------- Base ---------- */
  * { box-sizing: border-box; }
  body{
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    margin:0;
    padding:0;
    color:#111827;
    background:
      radial-gradient(1200px 400px at 0% -10%, rgba(140,47,59,.07), transparent 60%) ,
      linear-gradient(#ffffff, #fbfbfc);
    min-height:100dvh;
  }
  .wrap{ max-width: 880px; margin: 0 auto; padding: 28px 20px 48px; }

  /* ---------- Header / Brand ---------- */
  .site-header{
    background: radial-gradient(600px 220px at 10% -30%, rgba(140,47,59,.14), transparent 60%);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 18px 18px;
    box-shadow: var(--shadow);
  }
  .brand{
    display:flex; align-items:center; gap:14px; flex-wrap:wrap;
  }
  .logo{
    height:52px; width:auto; display:block;
  }
  .titles h1{
    font-size: clamp(1.35rem, 1.1rem + 1.2vw, 1.85rem);
    line-height:1.2; margin:0 0 4px; color: var(--brand-ink);
  }
  .titles .muted{ color: var(--muted); }

  /* Lookup bar */
  .tools{
    margin-top:14px; display:flex; gap:10px; flex-wrap:wrap;
  }
  .input{
    flex:1 1 320px; min-width:240px;
    padding:10px 12px; border:1px solid var(--border);
    border-radius:10px; outline: none; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
  }
  .input:focus{ border-color: var(--brand); box-shadow: 0 0 0 3px rgba(140,47,59,.15); }
  .btn{
    cursor:pointer; border:1px solid var(--border); border-radius:10px;
    background:#fff; padding:10px 14px; font-weight:600;
  }
  .btn.primary{ background: var(--brand); color:#fff; border-color: var(--brand); }
  .btn.primary:hover{ filter:brightness(.95); }
  .btn.ghost:hover{ background:#f4f5f7; }
  .btn:focus-visible{ outline: 3px solid rgba(140,47,59,.35); outline-offset: 2px; }

  /* ---------- Cards ---------- */
  .card{
    border:1px solid var(--border);
    background: var(--surface);
    border-radius: var(--radius);
    padding: 16px 18px;
    margin: 16px 0;
    box-shadow: var(--shadow);
  }
  .card.status{
    display:grid; grid-template-columns: 48px 1fr; gap:12px; align-items:flex-start;
    position:relative; overflow:hidden;
  }
  .card.status::before{
    content:""; position:absolute; inset:0 0 0 auto; width:6px; background:transparent;
  }
  .card.ok::before{ background: var(--ok); }
  .card.bad::before{ background: var(--bad); }
  .status-icon{
    width:44px; height:44px; border-radius:50%;
    display:grid; place-items:center;
    background: #eef6ef;
    border: 1px solid #cfe3d1;
  }
  .bad .status-icon{ background:#fdecec; border-color:#f5c7c7; }
  .status-title{ font-weight:700; margin:0 0 4px; }
  .status-desc{ color: var(--muted); margin:0; }

  /* ---------- Details ---------- */
  .row{
    display:grid; grid-template-columns: 200px 1fr; gap: 14px;
    padding: 10px 0; border-top: 1px dashed var(--border);
  }
  .row:first-child{ border-top:0; }
  .muted{ color: var(--muted); font-size:.95rem; }
  code{ background:#f6f8fa; padding:2px 6px; border-radius:6px; }

  /* ---------- Actions ---------- */
  .actions{ margin-top: 12px; display:flex; gap:8px; flex-wrap:wrap; }

  /* ---------- Motion ---------- */
  .slide-in{ animation: slide-in .24s ease-out both; }
  @keyframes slide-in{ from { transform: translateY(4px); opacity:.0; } to{ transform:none; opacity:1; } }
  @media (prefers-reduced-motion: reduce){
    .slide-in{ animation:none; }
  }

  footer{ color: var(--muted); margin-top: 24px; text-align: left; }
</style>
</head>
<body>
  <div class="wrap">

    <!-- Header / Branding -->
    <header class="site-header slide-in">
      <div class="brand">
        <!-- Replace src if your logo lives somewhere else -->
        <img class="logo" src="assets/redops-logo.png" alt="RedOps logo">
        <div class="titles">
          <h1>Certificate Verification</h1>
          <div class="muted">Workshop – Endpoint Security Insights by RedOps GmbH</div>
        </div>
      </div>

      <!-- Optional in‑page lookup (also works via URL like ?c=RED-… or /RED-… ) -->
      <form id="lookup" class="tools" autocomplete="off">
        <input id="id-input" class="input" name="c" placeholder="RED-ABCD-EF12-3456" 
               aria-label="Certificate ID"
               pattern="^RED-[A-Za-z0-9]{4}-[A-Za-z0-9]{4}-[A-Za-z0-9]{4}$"
               title="Format: RED-XXXX-XXXX-XXXX" />
        <button class="btn primary" type="submit">Verify</button>
        <button class="btn ghost" type="button" id="clear">Clear</button>
      </form>
    </header>

    <!-- Status panel -->
    <div id="panel" class="card status slide-in">
      <div class="status-icon" aria-hidden="true">
        <!-- placeholder spinner-ish glyph -->
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <circle cx="12" cy="12" r="9" stroke="#9aa1a9" stroke-width="2" stroke-dasharray="56" stroke-dashoffset="42"/>
        </svg>
      </div>
      <div>
        <p class="status-title">Looking up the certificate…</p>
        <p class="status-desc">Hang tight while we verify this ID.</p>
      </div>
    </div>

    <!-- Details -->
    <div id="details" class="card slide-in" style="display:none"></div>

    <footer>
      If you believe a result is incorrect, please contact the issuer.
    </footer>
  </div>

<script>
(function () {
  const TITLE = 'Certificate Verification';

  const $ = (sel) => document.querySelector(sel);

  // Inline SVG for status icons (no external assets)
  const icons = {
    ok: '<svg width="26" height="26" viewBox="0 0 24 24" fill="none" aria-hidden="true"><circle cx="12" cy="12" r="10" fill="#eaf6ec" stroke="#2e7d32" stroke-width="2"/><path d="M7 12.5l3 3 7-7" stroke="#2e7d32" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round"/></svg>',
    bad: '<svg width="26" height="26" viewBox="0 0 24 24" fill="none" aria-hidden="true"><circle cx="12" cy="12" r="10" fill="#fdecec" stroke="#c62828" stroke-width="2"/><path d="M8 8l8 8M16 8l-8 8" stroke="#c62828" stroke-width="2.25" stroke-linecap="round"/></svg>',
    info: '<svg width="26" height="26" viewBox="0 0 24 24" fill="none" aria-hidden="true"><circle cx="12" cy="12" r="10" fill="#eef2ff" stroke="#4f46e5" stroke-width="2"/><path d="M12 8.5h.01M11 11h2v5h-2z" stroke="#4f46e5" stroke-width="2" stroke-linecap="round"/></svg>'
  };

  function candidateId() {
    try {
      const url = new URL(window.location.href);
      let id = url.searchParams.get('c');
      if (!id) {
        let p = decodeURIComponent(url.pathname)
          .replace(/^\/+|\/+$/g, '')
          .replace(/index\.html$/i, '')
          .replace(/verify\.html$/i, '');
        if (p) id = p;
      }
      return (id || '').toUpperCase().trim();
    } catch (e) { return ''; }
  }

  function validFormat(id) {
    // Accepts RED-XXXX-XXXX-XXXX (A-Z, 0-9). Relax this if you use another scheme.
    return /^RED-[A-Z0-9]{4}-[A-Z0-9]{4}-[A-Z0-9]{4}$/.test(id);
  }

  function setPanel(title, desc, kind /* 'ok' | 'bad' | 'info' */) {
    const el = $('#panel');
    el.className = 'card status ' + (kind === 'ok' ? 'ok' : kind === 'bad' ? 'bad' : '');
    el.innerHTML = `
      <div class="status-icon" aria-hidden="true">${icons[kind] || icons.info}</div>
      <div>
        <p class="status-title">${title}</p>
        ${desc ? `<p class="status-desc">${desc}</p>` : ''}
        <div class="actions" id="actions" style="display:none"></div>
      </div>`;
  }

  function setDetails(rows) {
    const el = $('#details');
    if (!rows || !rows.length) { el.style.display = 'none'; return; }
    el.style.display = 'block';
    el.innerHTML = rows.map(([k,v]) => `
      <div class="row">
        <div class="muted">${k}</div>
        <div>${v || '<span class="muted">(not provided)</span>'}</div>
      </div>`).join('');
  }

  async function loadDb() {
    const res = await fetch('ids.json', { cache: 'no-store' });
    if (!res.ok) throw new Error(res.statusText);
    return res.json();
  }

  function addActionsBar() {
    const bar = $('#actions');
    if (!bar) return;
    bar.style.display = 'flex';

    const copyBtn = Object.assign(document.createElement('button'), { className:'btn ghost', textContent: 'Copy link' });
    copyBtn.onclick = () => navigator.clipboard.writeText(window.location.href).then(() => {
      copyBtn.textContent = 'Copied!';
      setTimeout(() => copyBtn.textContent = 'Copy link', 1500);
    });
    bar.appendChild(copyBtn);

    if (navigator.share) {
      const share = Object.assign(document.createElement('button'), { className:'btn ghost', textContent: 'Share…' });
      share.onclick = () => navigator.share({ title: document.title, url: window.location.href }).catch(()=>{});
      bar.appendChild(share);
    }
  }

  async function main() {
    const id = candidateId();
    const input = $('#id-input');
    if (input) input.value = id || '';

    if (!id) {
      document.title = TITLE;
      setPanel('No certificate ID provided.',
               'Append ?c=RED-XXXX-XXXX-XXXX to the URL, open /RED-XXXX-XXXX-XXXX, or use the lookup box above.',
               'info');
      setDetails(null);
      return;
    }

    document.title = `${TITLE} – ${id}`;

    if (!validFormat(id)) {
      setPanel('Invalid ID format.',
               `Got <code>${id}</code>. Expected something like <code>RED-ABCD-1234-EF56</code>.`,
               'bad');
      setDetails(null);
      return;
    }

    let db;
    try {
      db = await loadDb();
    } catch (e) {
      setPanel('Could not load the verification database.',
               'The file <code>ids.json</code> could not be retrieved. Try again or contact the issuer.',
               'bad');
      setDetails(null);
      return;
    }

    const rec = db[id];
    if (!rec) {
      setPanel('Not found.',
               `The certificate <code>${id}</code> is not in our list, or may have been revoked.`,
               'bad');
      setDetails([['Certificate ID', `<code>${id}</code>`]]);
      return;
    }

    if (rec.revoked) {
      setPanel('Revoked.',
               `The certificate <code>${id}</code> was revoked by the issuer.`,
               'bad');
      setDetails([
        ['Certificate ID', `<code>${id}</code>`],
        ['Revoked on', rec.revoked_on || '' ],
        ['Reason', rec.reason || '' ]
      ]);
      return;
    }

    setPanel('Valid certificate.', `ID <code>${id}</code> was issued by the organization.`, 'ok');
    setDetails([
      ['Certificate ID', `<code>${id}</code>`],
      ['Participant', rec.participant_name || '' ],
      ['Issue date', rec.issue_date || '' ]
    ]);
    addActionsBar();
  }

  // In‑page lookup: updates the URL and re‑runs verification
  $('#lookup')?.addEventListener('submit', (e) => {
    e.preventDefault();
    const val = $('#id-input').value.trim().toUpperCase();
    const url = new URL(window.location.href);
    // Support both query and path-style deep links
    url.searchParams.set('c', val);
    window.history.pushState({}, '', url.toString());
    main();
  });
  $('#clear')?.addEventListener('click', () => {
    const url = new URL(window.location.href);
    url.searchParams.delete('c');
    window.history.pushState({}, '', url.toString());
    $('#id-input').value = '';
    main();
  });

  window.addEventListener('popstate', main);
  main();
})();
</script>
</body>
</html>
